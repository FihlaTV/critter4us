<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>File: 2.4.0.txt</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



  <div id="fileHeader">
    <h1>2.4.0.txt</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>doc/release_notes/2.4.0.txt
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sat Jul 25 16:28:14 -0500 2009</td>
    </tr>
    </table>
  </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Prepared Statements/Bound Variables
</p>
<h6>=============================</h6>
<p>
<a href="../../../classes/Sequel.html">Sequel</a> now supports prepared
statements and bound variables. No matter which database you are using, <a
href="../../../classes/Sequel.html">Sequel</a> uses exactly the same API.
To specify placeholders, you use the :$placeholder syntax:
</p>
<pre>
  ds = DB[:items].filter(:name=&gt;:$n)
</pre>
<p>
To use a bound variable:
</p>
<pre>
  ds.call(:select, :n=&gt;'Jim')
</pre>
<p>
This will do the equivalent of selecting records that have the name
&#8216;Jim&#8217;. In addition to :select, you can use :first or :delete.
There is also support for bound variables when inserting or updating
records:
</p>
<pre>
  ds.call(:update, {:n=&gt;'Jim', :new_n=&gt;'Bob'}, :name=&gt;:$new_n)
</pre>
<p>
Which will update all records that have the name &#8216;Jim&#8217; to have
the name &#8216;Bob&#8217;.
</p>
<p>
Prepared statement support is very similar to bound variable support,
except that the statement is first prepared with a name:
</p>
<pre>
  ps = ds.prepare(:select, :select_by_name)
</pre>
<p>
It is then called later with the bound arguments to use:
</p>
<pre>
  ps.call(:n=&gt;'Jim')
  DB.call(:select_by_name, :n=&gt;'Jim') # same as above
</pre>
<p>
For inserting or updating, the hash to use when inserting or updating is
given to prepare:
</p>
<pre>
  ps2 = ds.prepare(:update, :update_name, :name=&gt;:$new_n)
  ps2.call(:n=&gt;'Jim', :new_n=&gt;'Bob')
</pre>
<p>
There is some level of native support for these features in the PostgreSQL,
MySQL, SQLite, and JDBC adapters. For other adapters, support is emulated,
but it shouldn&#8216;t be too difficult to add native support for them.
</p>
<p>
For more details see: <a
href="http://sequel.rubyforge.org/rdoc/files/doc/prepared_statements_rdoc.html">sequel.rubyforge.org/rdoc/files/doc/prepared_statements_rdoc.html</a>
</p>
<p>
Read-Only Slave/Writable Master and Database Sharding
</p>
<h6>===============================================</h6>
<p>
<a href="../../../classes/Sequel.html">Sequel</a> now has built in support
for master/slave database configurations, just by setting an option in <a
href="../../../classes/Sequel.html#M000065">Sequel.connect</a>:
</p>
<pre>
  DB=Sequel.connect('postgres://master_server/database', \
    :servers=&gt;{:read_only=&gt;{:host=&gt;'slave_server'}})
</pre>
<p>
That will use slave_server for SELECT queries and master_server for other
queries. It&#8216;s fairly easy to use multiple slaves or even multiple
masters, examples are included in the link below.
</p>
<p>
Sharding support requires some code other than the database configuration,
but is still fairly simple. For example, to set up a 16 shard configuration
based on a hex character:
</p>
<pre>
  servers = {}
  (('0'..'9').to_a + ('a'..'f').to_a).each do |hex|
    servers[hex.to_sym] = {:host=&gt;&quot;hash_host_#{hex}&quot;}
  end
  DB=Sequel.connect('postgres://hash_host/hashes', :servers=&gt;servers)
</pre>
<p>
To set which shard to use for a query, use the Dataset#server method:
</p>
<pre>
  DB[:hashes].server(:a).filter(:hash=&gt;/31337/)
</pre>
<p>
For more details see: <a
href="http://sequel.rubyforge.org/rdoc/files/doc/sharding_rdoc.html">sequel.rubyforge.org/rdoc/files/doc/sharding_rdoc.html</a>
</p>
<p>
Other Changes
</p>
<h6>=======</h6>
<ul>
<li>The sequel.rubyforge.org website has a new design thanks to boof. The
online RDoc is now located at <a
href="http://sequel.rubyforge.org/rdoc">sequel.rubyforge.org/rdoc</a>.

</li>
<li>Support was added for anonymous column names in the ADO adapter.

</li>
<li>Better MSSQL support in the ADO, ODBC, and JDBC adapters. The odbc_mssql
adapter has been removed. If you use MSSQL with ODBC, please use the odbc
adapter with a :db_type=&gt;&#8217;mssql&#8217; option.

</li>
<li>The following <a
href="../../../classes/Sequel/Error.html">Sequel::Error</a> exception
subclasses were removed: InvalidExpression, InvalidFilter, InvalidJoinType,
and WorkerStop.

</li>
<li>Documentation was added for the PostgreSQL, MySQL, SQLite, and JDBC
adapters.

</li>
<li>Various internal interfaces were refactored. For example, if you use an
adapter not included with <a
href="../../../classes/Sequel.html">Sequel</a>, it probably won&#8216;t
work until you update it to the new internal API.

</li>
<li>Many low level methods (such as Database#transaction), now take an optional
server argument to indicate which server to use.

</li>
<li>Model plugins that have a DatasetMethods module with non-public methods no
longer have Model methods created that call those methods.

</li>
</ul>

    </div>


   </div>


  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>