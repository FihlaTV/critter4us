<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Array</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Array</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/lib/sequel/core_sql_rb.html">
                lib/sequel/core_sql.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="Object.html">
                Object
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="Sequel.html">Sequel</a> extends the <a href="Array.html">Array</a>
class to add methods to implement the SQL DSL. Most of these methods
require that the array not be empty and that it must consist solely of
other arrays that have exactly two elements.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000018">all_two_pairs?</a>&nbsp;&nbsp;
      <a href="#M000019">case</a>&nbsp;&nbsp;
      <a href="#M000020">sql_array</a>&nbsp;&nbsp;
      <a href="#M000021">sql_expr</a>&nbsp;&nbsp;
      <a href="#M000022">sql_negate</a>&nbsp;&nbsp;
      <a href="#M000023">sql_or</a>&nbsp;&nbsp;
      <a href="#M000024">sql_string_join</a>&nbsp;&nbsp;
      <a href="#M000017">~</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">all_two_pairs?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
True if the array is not empty and all of its elements are arrays of size
2, false otherwise. This is used to determine if the array could be a
specifier of conditions, used similarly to a hash but allowing for
duplicate keys and a specific order.
</p>
<pre>
   [].to_a.all_two_pairs? # =&gt; false
   [:a].to_a.all_two_pairs? # =&gt; false
   [[:b]].to_a.all_two_pairs? # =&gt; false
   [[:a, 1]].to_a.all_two_pairs? # =&gt; true
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/core_sql.rb, line 23</span>
23:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_two_pairs?</span>
24:     <span class="ruby-operator">!</span><span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">all?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> (<span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">i</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">i</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>)}
25:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000019" class="method-detail">
        <a name="M000019"></a>

        <div class="method-heading">
          <a href="#M000019" class="method-signature">
          <span class="method-name">case</span><span class="method-args">(default, expression = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return a <a
href="Sequel/SQL/CaseExpression.html">Sequel::SQL::CaseExpression</a> with
this array as the conditions and the given default value and expression.
</p>
<pre>
  [[{:a=&gt;[2,3]}, 1]].case(0) # SQL: CASE WHEN a IN (2, 3) THEN 1 ELSE 0 END
  [[:a, 1], [:b, 2]].case(:d, :c) # SQL: CASE c WHEN a THEN 1 WHEN b THEN 2 ELSE d END
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000019-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000019-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/core_sql.rb, line 32</span>
32:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">case</span>(<span class="ruby-identifier">default</span>, <span class="ruby-identifier">expression</span> = <span class="ruby-keyword kw">nil</span>)
33:     <span class="ruby-operator">::</span><span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">CaseExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">default</span>, <span class="ruby-identifier">expression</span>)
34:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000020" class="method-detail">
        <a name="M000020"></a>

        <div class="method-heading">
          <a href="#M000020" class="method-signature">
          <span class="method-name">sql_array</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return a <a href="Array.html">Sequel::SQL::Array</a> created from this
array. Used if this array contains all two pairs and you want it treated as
an SQL array instead of a ordered hash-like conditions.
</p>
<pre>
  [[1, 2], [3, 4]] # SQL: 1 = 2 AND 3 = 4
  [[1, 2], [3, 4]].sql_array # SQL: ((1, 2), (3, 4))
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000020-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000020-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/core_sql.rb, line 42</span>
42:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_array</span>
43:     <span class="ruby-operator">::</span><span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">SQLArray</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>)
44:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000021" class="method-detail">
        <a name="M000021"></a>

        <div class="method-heading">
          <a href="#M000021" class="method-signature">
          <span class="method-name">sql_expr</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return a <a
href="Sequel/SQL/BooleanExpression.html">Sequel::SQL::BooleanExpression</a>
created from this array, matching all of the conditions. Rarely do you need
to call this explicitly, as <a href="Sequel.html">Sequel</a> generally
assumes that arrays of all two pairs specify this type of condition.
</p>
<pre>
  [[:a, true]].sql_expr # SQL: a IS TRUE
  [[:a, 1], [:b, [2, 3]]].sql_expr # SQL: a = 1 AND b IN (2, 3)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000021-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000021-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/core_sql.rb, line 52</span>
52:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_expr</span>
53:     <span class="ruby-identifier">sql_expr_if_all_two_pairs</span>
54:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000022" class="method-detail">
        <a name="M000022"></a>

        <div class="method-heading">
          <a href="#M000022" class="method-signature">
          <span class="method-name">sql_negate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return a <a
href="Sequel/SQL/BooleanExpression.html">Sequel::SQL::BooleanExpression</a>
created from this array, matching none of the conditions.
</p>
<pre>
  [[:a, true]].sql_negate # SQL: a IS NOT TRUE
  [[:a, 1], [:b, [2, 3]]].sql_negate # SQL: a != 1 AND b NOT IN (2, 3)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000022-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000022-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/core_sql.rb, line 61</span>
61:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_negate</span>
62:     <span class="ruby-identifier">sql_expr_if_all_two_pairs</span>(<span class="ruby-identifier">:AND</span>, <span class="ruby-keyword kw">true</span>)
63:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000023" class="method-detail">
        <a name="M000023"></a>

        <div class="method-heading">
          <a href="#M000023" class="method-signature">
          <span class="method-name">sql_or</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return a <a
href="Sequel/SQL/BooleanExpression.html">Sequel::SQL::BooleanExpression</a>
created from this array, matching any of the conditions.
</p>
<pre>
  [[:a, true]].sql_or # SQL: a IS TRUE
  [[:a, 1], [:b, [2, 3]]].sql_or # SQL: a = 1 OR b IN (2, 3)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000023-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000023-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/core_sql.rb, line 70</span>
70:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_or</span>
71:     <span class="ruby-identifier">sql_expr_if_all_two_pairs</span>(<span class="ruby-identifier">:OR</span>)
72:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000024" class="method-detail">
        <a name="M000024"></a>

        <div class="method-heading">
          <a href="#M000024" class="method-signature">
          <span class="method-name">sql_string_join</span><span class="method-args">(joiner=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return a <a
href="Sequel/SQL/BooleanExpression.html">Sequel::SQL::BooleanExpression</a>
representing an SQL string made up of the concatenation of this
array&#8216;s elements. If an argument is passed it is used in between each
element of the array in the SQL concatenation. This does not require that
the array be made up of all two pairs.
</p>
<pre>
  [:a].sql_string_join # SQL: a
  [:a, :b].sql_string_join # SQL: a || b
  [:a, 'b'].sql_string_join # SQL: a || 'b'
  ['a', :b].sql_string_join(' ') # SQL: 'a' || ' ' || b
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000024-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000024-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/core_sql.rb, line 83</span>
83:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_string_join</span>(<span class="ruby-identifier">joiner</span>=<span class="ruby-keyword kw">nil</span>)
84:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">joiner</span>
85:       <span class="ruby-identifier">args</span> = <span class="ruby-identifier">zip</span>([<span class="ruby-identifier">joiner</span>]<span class="ruby-operator">*</span><span class="ruby-identifier">length</span>).<span class="ruby-identifier">flatten</span>
86:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span>
87:     <span class="ruby-keyword kw">else</span>
88:       <span class="ruby-identifier">args</span> = <span class="ruby-keyword kw">self</span>
89:     <span class="ruby-keyword kw">end</span>
90:     <span class="ruby-identifier">args</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> [<span class="ruby-constant">Symbol</span>, <span class="ruby-operator">::</span><span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Expression</span>, <span class="ruby-operator">::</span><span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">LiteralString</span>, <span class="ruby-constant">TrueClass</span>, <span class="ruby-constant">FalseClass</span>, <span class="ruby-constant">NilClass</span>].<span class="ruby-identifier">any?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-identifier">c</span>)} <span class="ruby-operator">?</span> <span class="ruby-identifier">a</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">to_s</span>}
91:     <span class="ruby-operator">::</span><span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">StringExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'||'</span><span class="ruby-value str">'||'</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
92:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">~</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return a <a
href="Sequel/SQL/BooleanExpression.html">Sequel::SQL::BooleanExpression</a>
created from this array, not matching all of the conditions.
</p>
<pre>
  ~[[:a, true]] # SQL: a IS NOT TRUE
  ~[[:a, 1], [:b, [2, 3]]] # SQL: a != 1 OR b NOT IN (2, 3)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/core_sql.rb, line 10</span>
10:   <span class="ruby-keyword kw">def</span> <span class="ruby-operator">~</span>
11:     <span class="ruby-identifier">sql_expr_if_all_two_pairs</span>(<span class="ruby-identifier">:OR</span>, <span class="ruby-keyword kw">true</span>)
12:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>