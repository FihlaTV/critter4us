<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: Sequel::Plugins::ValidationHelpers::InstanceMethods</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">Sequel::Plugins::ValidationHelpers::InstanceMethods</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../../files/lib/sequel/plugins/validation_helpers_rb.html">
                lib/sequel/plugins/validation_helpers.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="../ValidationHelpers.html">ValidationHelpers</a> contains instance
method equivalents for most of the previous default validations. The names
and APIs have changed, though.
</p>
<p>
The <a href="InstanceMethods.html#M000087">validates_unique</a> validation
has a unique API, but the other validations have the API explained here:
</p>
<p>
Arguments:
</p>
<ul>
<li>atts - Single attribute symbol or an array of attribute symbols specifying
the attribute(s) to validate.

</li>
</ul>
<p>
Options:
</p>
<ul>
<li>:allow_blank - Whether to skip the validation if the value is blank. You
should make sure all objects respond to blank if you use this option, which
you can do by requiring &#8216;sequel/extensions/blank&#8216;

</li>
<li>:allow_missing - Whether to skip the validation if the attribute
isn&#8216;t a key in the values hash. This is different from allow_nil,
because <a href="../../../Sequel.html">Sequel</a> only sends the attributes
in the values when doing an insert or update. If the attribute is not
present, <a href="../../../Sequel.html">Sequel</a> doesn&#8216;t specify
it, so the database will use the table&#8216;s default value. This is
different from having an attribute in values with a value of nil, which <a
href="../../../Sequel.html">Sequel</a> will send as NULL. If your database
table has a non NULL default, this may be a good option to use. You
don&#8216;t want to use allow_nil, because if the attribute is in values
but has a value nil, <a href="../../../Sequel.html">Sequel</a> will attempt
to insert a NULL value into the database, instead of using the
database&#8216;s default.

</li>
<li>:allow_nil - Whether to skip the validation if the value is nil.

</li>
<li>:message - The message to use

</li>
</ul>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000077">validates_exact_length</a>&nbsp;&nbsp;
      <a href="#M000078">validates_format</a>&nbsp;&nbsp;
      <a href="#M000079">validates_includes</a>&nbsp;&nbsp;
      <a href="#M000080">validates_integer</a>&nbsp;&nbsp;
      <a href="#M000081">validates_length_range</a>&nbsp;&nbsp;
      <a href="#M000082">validates_max_length</a>&nbsp;&nbsp;
      <a href="#M000083">validates_min_length</a>&nbsp;&nbsp;
      <a href="#M000084">validates_not_string</a>&nbsp;&nbsp;
      <a href="#M000085">validates_numeric</a>&nbsp;&nbsp;
      <a href="#M000086">validates_presence</a>&nbsp;&nbsp;
      <a href="#M000087">validates_unique</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000077" class="method-detail">
        <a name="M000077"></a>

        <div class="method-heading">
          <a href="#M000077" class="method-signature">
          <span class="method-name">validates_exact_length</span><span class="method-args">(exact, atts, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Check that the attribute values are the given exact length.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000077-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000077-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/plugins/validation_helpers.rb, line 30</span>
30:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validates_exact_length</span>(<span class="ruby-identifier">exact</span>, <span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>={})
31:           <span class="ruby-identifier">validatable_attributes</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">v</span>,<span class="ruby-identifier">m</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">m</span> <span class="ruby-operator">||</span> <span class="ruby-node">&quot;is not #{exact} characters&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">exact</span>}
32:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000078" class="method-detail">
        <a name="M000078"></a>

        <div class="method-heading">
          <a href="#M000078" class="method-signature">
          <span class="method-name">validates_format</span><span class="method-args">(with, atts, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Check the string representation of the attribute value(s) against the
regular expression with.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000078-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000078-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/plugins/validation_helpers.rb, line 35</span>
35:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validates_format</span>(<span class="ruby-identifier">with</span>, <span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>={})
36:           <span class="ruby-identifier">validatable_attributes</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">v</span>,<span class="ruby-identifier">m</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">m</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'is invalid'</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">with</span>}
37:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000079" class="method-detail">
        <a name="M000079"></a>

        <div class="method-heading">
          <a href="#M000079" class="method-signature">
          <span class="method-name">validates_includes</span><span class="method-args">(set, atts, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Check attribute value(s) is included in the given set.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000079-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000079-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/plugins/validation_helpers.rb, line 40</span>
40:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validates_includes</span>(<span class="ruby-identifier">set</span>, <span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>={})
41:           <span class="ruby-identifier">validatable_attributes</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">v</span>,<span class="ruby-identifier">m</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">m</span> <span class="ruby-operator">||</span> <span class="ruby-node">&quot;is not in range or set: #{set.inspect}&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">set</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">v</span>)}
42:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000080" class="method-detail">
        <a name="M000080"></a>

        <div class="method-heading">
          <a href="#M000080" class="method-signature">
          <span class="method-name">validates_integer</span><span class="method-args">(atts, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Check attribute value(s) string representation is a valid integer.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000080-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000080-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/plugins/validation_helpers.rb, line 45</span>
45:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validates_integer</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>={})
46:           <span class="ruby-identifier">validatable_attributes</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">v</span>,<span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
47:             <span class="ruby-keyword kw">begin</span>
48:               <span class="ruby-constant">Kernel</span>.<span class="ruby-constant">Integer</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span>)
49:               <span class="ruby-keyword kw">nil</span>
50:             <span class="ruby-keyword kw">rescue</span>
51:               <span class="ruby-identifier">m</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'is not a number'</span>
52:             <span class="ruby-keyword kw">end</span>
53:           <span class="ruby-keyword kw">end</span>
54:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000081" class="method-detail">
        <a name="M000081"></a>

        <div class="method-heading">
          <a href="#M000081" class="method-signature">
          <span class="method-name">validates_length_range</span><span class="method-args">(range, atts, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Check that the attribute values length is in the specified range.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000081-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000081-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/plugins/validation_helpers.rb, line 57</span>
57:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validates_length_range</span>(<span class="ruby-identifier">range</span>, <span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>={})
58:           <span class="ruby-identifier">validatable_attributes</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">v</span>,<span class="ruby-identifier">m</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">m</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;is outside the allowed range&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">range</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">length</span>)}
59:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000082" class="method-detail">
        <a name="M000082"></a>

        <div class="method-heading">
          <a href="#M000082" class="method-signature">
          <span class="method-name">validates_max_length</span><span class="method-args">(max, atts, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Check that the attribute values are not longer than the given max length.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000082-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000082-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/plugins/validation_helpers.rb, line 62</span>
62:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validates_max_length</span>(<span class="ruby-identifier">max</span>, <span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>={})
63:           <span class="ruby-identifier">validatable_attributes</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">v</span>,<span class="ruby-identifier">m</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">m</span> <span class="ruby-operator">||</span> <span class="ruby-node">&quot;is longer than #{max} characters&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">max</span>}
64:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000083" class="method-detail">
        <a name="M000083"></a>

        <div class="method-heading">
          <a href="#M000083" class="method-signature">
          <span class="method-name">validates_min_length</span><span class="method-args">(min, atts, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Check that the attribute values are not shorter than the given min length.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000083-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000083-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/plugins/validation_helpers.rb, line 67</span>
67:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validates_min_length</span>(<span class="ruby-identifier">min</span>, <span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>={})
68:           <span class="ruby-identifier">validatable_attributes</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">v</span>,<span class="ruby-identifier">m</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">m</span> <span class="ruby-operator">||</span> <span class="ruby-node">&quot;is shorter than #{min} characters&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">min</span>}
69:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000084" class="method-detail">
        <a name="M000084"></a>

        <div class="method-heading">
          <a href="#M000084" class="method-signature">
          <span class="method-name">validates_not_string</span><span class="method-args">(atts, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Check that the attribute value(s) is not a string. This is generally useful
in conjunction with raise_on_typecast_failure = false, where you are
passing in string values for non-string attributes (such as numbers and
dates). If typecasting fails (invalid number or date), the value of the
attribute will be a string in an invalid format, and if typecasting
succeeds, the value will not be a string.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000084-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000084-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/plugins/validation_helpers.rb, line 77</span>
77:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validates_not_string</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>={})
78:           <span class="ruby-identifier">validatable_attributes</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">v</span>,<span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
79:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
80:             <span class="ruby-keyword kw">next</span> <span class="ruby-identifier">m</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">m</span>
81:             (<span class="ruby-identifier">sch</span> = <span class="ruby-identifier">db_schema</span>[<span class="ruby-identifier">a</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">typ</span> = <span class="ruby-identifier">sch</span>[<span class="ruby-identifier">:type</span>]) <span class="ruby-operator">?</span>  <span class="ruby-node">&quot;is not a valid #{typ}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;is a string&quot;</span>
82:           <span class="ruby-keyword kw">end</span>
83:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000085" class="method-detail">
        <a name="M000085"></a>

        <div class="method-heading">
          <a href="#M000085" class="method-signature">
          <span class="method-name">validates_numeric</span><span class="method-args">(atts, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Check attribute value(s) string representation is a valid float.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000085-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000085-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel/plugins/validation_helpers.rb, line 86</span>
86:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validates_numeric</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>={})
87:           <span class="ruby-identifier">validatable_attributes</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">v</span>,<span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
88:             <span class="ruby-keyword kw">begin</span>
89:               <span class="ruby-constant">Kernel</span>.<span class="ruby-constant">Float</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span>)
90:               <span class="ruby-keyword kw">nil</span>
91:             <span class="ruby-keyword kw">rescue</span>
92:               <span class="ruby-identifier">m</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'is not a number'</span>
93:             <span class="ruby-keyword kw">end</span>
94:           <span class="ruby-keyword kw">end</span>
95:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000086" class="method-detail">
        <a name="M000086"></a>

        <div class="method-heading">
          <a href="#M000086" class="method-signature">
          <span class="method-name">validates_presence</span><span class="method-args">(atts, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Check attribute value(s) is not considered blank by the database, but allow
false values.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000086-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000086-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/plugins/validation_helpers.rb, line 98</span>
 98:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validates_presence</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>={})
 99:           <span class="ruby-identifier">validatable_attributes</span>(<span class="ruby-identifier">atts</span>, <span class="ruby-identifier">opts</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">v</span>,<span class="ruby-identifier">m</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">m</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;is not present&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">model</span>.<span class="ruby-identifier">db</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:blank_object?</span>, <span class="ruby-identifier">v</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>}
100:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000087" class="method-detail">
        <a name="M000087"></a>

        <div class="method-heading">
          <a href="#M000087" class="method-signature">
          <span class="method-name">validates_unique</span><span class="method-args">(*atts)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Checks that there are no duplicate values in the database for the given
attributes. Pass an array of fields instead of multiple fields to specify
that the combination of fields must be unique, instead of that each field
should have a unique value.
</p>
<p>
This means that the code:
</p>
<pre>
  validates_unique([:column1, :column2])
</pre>
<p>
validates the grouping of column1 and column2 while
</p>
<pre>
  validates_unique(:column1, :column2)
</pre>
<p>
validates them separately.
</p>
<p>
You should also add a unique index in the database, as this suffers from a
fairly obvious race condition.
</p>
<p>
This validation does not respect the :allow_* options that the other
validations accept, since it can deals with multiple attributes at once.
</p>
<p>
Possible Options:
</p>
<ul>
<li>:message - The message to use (default: &#8216;is already taken&#8217;)

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000087-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000087-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/plugins/validation_helpers.rb, line 121</span>
121:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validates_unique</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>)
122:           <span class="ruby-identifier">message</span> = (<span class="ruby-identifier">atts</span>.<span class="ruby-identifier">pop</span>[<span class="ruby-identifier">:message</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">atts</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)) <span class="ruby-operator">||</span> <span class="ruby-value str">'is already taken'</span>
123:           <span class="ruby-identifier">atts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
124:             <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">model</span>.<span class="ruby-identifier">filter</span>(<span class="ruby-constant">Array</span>(<span class="ruby-identifier">a</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">x</span>, <span class="ruby-identifier">send</span>(<span class="ruby-identifier">x</span>)]})
125:             <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">message</span>) <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">new?</span> <span class="ruby-value">? </span><span class="ruby-identifier">ds</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">exclude</span>(<span class="ruby-identifier">pk_hash</span>)).<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
126:           <span class="ruby-keyword kw">end</span>
127:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>