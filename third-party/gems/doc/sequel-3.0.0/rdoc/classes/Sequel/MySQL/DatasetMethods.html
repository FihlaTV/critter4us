<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: Sequel::MySQL::DatasetMethods</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">Sequel::MySQL::DatasetMethods</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/sequel/adapters/shared/mysql_rb.html">
                lib/sequel/adapters/shared/mysql.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="Dataset.html">Dataset</a> methods shared by datasets that use <a
href="../MySQL.html">MySQL</a> databases.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000361">complex_expression_sql</a>&nbsp;&nbsp;
      <a href="#M000362">delete_sql</a>&nbsp;&nbsp;
      <a href="#M000363">distinct</a>&nbsp;&nbsp;
      <a href="#M000364">full_text_search</a>&nbsp;&nbsp;
      <a href="#M000365">full_text_sql</a>&nbsp;&nbsp;
      <a href="#M000366">having</a>&nbsp;&nbsp;
      <a href="#M000367">insert_default_values_sql</a>&nbsp;&nbsp;
      <a href="#M000370">insert_ignore</a>&nbsp;&nbsp;
      <a href="#M000368">join_table</a>&nbsp;&nbsp;
      <a href="#M000369">join_type_sql</a>&nbsp;&nbsp;
      <a href="#M000372">multi_insert_sql</a>&nbsp;&nbsp;
      <a href="#M000371">on_duplicate_key_update</a>&nbsp;&nbsp;
      <a href="#M000373">quoted_identifier</a>&nbsp;&nbsp;
      <a href="#M000374">replace_sql</a>&nbsp;&nbsp;
      <a href="#M000375">update_sql</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name">Dataset::UnsupportedIntersectExcept</span>
      </div>
    </div>

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">BOOL_TRUE</td>
          <td>=</td>
          <td class="context-item-value">'1'.freeze</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">BOOL_FALSE</td>
          <td>=</td>
          <td class="context-item-value">'0'.freeze</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">TIMESTAMP_FORMAT</td>
          <td>=</td>
          <td class="context-item-value">&quot;'%Y-%m-%d %H:%M:%S'&quot;.freeze</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">COMMA_SEPARATOR</td>
          <td>=</td>
          <td class="context-item-value">', '.freeze</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000361" class="method-detail">
        <a name="M000361"></a>

        <div class="method-heading">
          <a href="#M000361" class="method-signature">
          <span class="method-name">complex_expression_sql</span><span class="method-args">(op, args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="../MySQL.html">MySQL</a> specific syntax for LIKE/REGEXP searches,
as well as string concatenation.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000361-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000361-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 197</span>
197:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">complex_expression_sql</span>(<span class="ruby-identifier">op</span>, <span class="ruby-identifier">args</span>)
198:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">op</span>
199:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:~</span>, <span class="ruby-value str">'!~'</span><span class="ruby-value str">'!~'</span>, <span class="ruby-value str">'~*'</span><span class="ruby-value str">'~*'</span>, <span class="ruby-value str">'!~*'</span><span class="ruby-value str">'!~*'</span>, <span class="ruby-identifier">:LIKE</span>, <span class="ruby-value str">'NOT LIKE'</span><span class="ruby-value str">'NOT LIKE'</span>, <span class="ruby-identifier">:ILIKE</span>, <span class="ruby-value str">'NOT ILIKE'</span><span class="ruby-value str">'NOT ILIKE'</span>
200:           <span class="ruby-node">&quot;(#{literal(args.at(0))} #{'NOT ' if [:'NOT LIKE', :'NOT ILIKE', :'!~', :'!~*'].include?(op)}#{[:~, :'!~', :'~*', :'!~*'].include?(op) ? 'REGEXP' : 'LIKE'} #{'BINARY ' if [:~, :'!~', :LIKE, :'NOT LIKE'].include?(op)}#{literal(args.at(1))})&quot;</span>
201:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'||'</span><span class="ruby-value str">'||'</span>
202:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
203:             <span class="ruby-node">&quot;CONCAT(#{args.collect{|a| literal(a)}.join(', ')})&quot;</span>
204:           <span class="ruby-keyword kw">else</span>
205:             <span class="ruby-identifier">literal</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">at</span>(<span class="ruby-value">0</span>))
206:           <span class="ruby-keyword kw">end</span>
207:         <span class="ruby-keyword kw">else</span>
208:           <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">op</span>, <span class="ruby-identifier">args</span>)
209:         <span class="ruby-keyword kw">end</span>
210:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000362" class="method-detail">
        <a name="M000362"></a>

        <div class="method-heading">
          <a href="#M000362" class="method-signature">
          <span class="method-name">delete_sql</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="../MySQL.html">MySQL</a> supports ORDER and LIMIT clauses in
DELETE statements.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000362-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000362-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 213</span>
213:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_sql</span>
214:         <span class="ruby-identifier">sql</span> = <span class="ruby-keyword kw">super</span>
215:         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; ORDER BY #{expression_list(opts[:order])}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:order</span>]
216:         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; LIMIT #{opts[:limit]}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:limit</span>]
217:         <span class="ruby-identifier">sql</span>
218:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000363" class="method-detail">
        <a name="M000363"></a>

        <div class="method-heading">
          <a href="#M000363" class="method-signature">
          <span class="method-name">distinct</span><span class="method-args">(*columns)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="../MySQL.html">MySQL</a> doesn&#8216;t support DISTINCT ON
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000363-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000363-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 221</span>
221:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">distinct</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>)
222:         <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;DISTINCT ON not supported by MySQL&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">empty?</span>
223:         <span class="ruby-keyword kw">super</span>
224:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000364" class="method-detail">
        <a name="M000364"></a>

        <div class="method-heading">
          <a href="#M000364" class="method-signature">
          <span class="method-name">full_text_search</span><span class="method-args">(cols, terms, opts = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds full text filter
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000364-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000364-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 227</span>
227:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">full_text_search</span>(<span class="ruby-identifier">cols</span>, <span class="ruby-identifier">terms</span>, <span class="ruby-identifier">opts</span> = {})
228:         <span class="ruby-identifier">filter</span>(<span class="ruby-identifier">full_text_sql</span>(<span class="ruby-identifier">cols</span>, <span class="ruby-identifier">terms</span>, <span class="ruby-identifier">opts</span>))
229:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000365" class="method-detail">
        <a name="M000365"></a>

        <div class="method-heading">
          <a href="#M000365" class="method-signature">
          <span class="method-name">full_text_sql</span><span class="method-args">(cols, term, opts = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="../MySQL.html">MySQL</a> specific full text search syntax.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000365-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000365-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 232</span>
232:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">full_text_sql</span>(<span class="ruby-identifier">cols</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">opts</span> = {})
233:         <span class="ruby-node">&quot;MATCH #{literal(Array(cols))} AGAINST (#{literal(Array(term).join(' '))}#{&quot; IN BOOLEAN MODE&quot; if opts[:boolean]})&quot;</span>
234:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000366" class="method-detail">
        <a name="M000366"></a>

        <div class="method-heading">
          <a href="#M000366" class="method-signature">
          <span class="method-name">having</span><span class="method-args">(*cond, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="../MySQL.html">MySQL</a> allows HAVING clause on ungrouped
datasets.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000366-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000366-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 237</span>
237:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">having</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
238:         <span class="ruby-identifier">_filter</span>(<span class="ruby-identifier">:having</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
239:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000367" class="method-detail">
        <a name="M000367"></a>

        <div class="method-heading">
          <a href="#M000367" class="method-signature">
          <span class="method-name">insert_default_values_sql</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="../MySQL.html">MySQL</a> doesn&#8216;t use the <a
href="../SQL.html">SQL</a> standard DEFAULT VALUES.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000367-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000367-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 242</span>
242:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">insert_default_values_sql</span>
243:         <span class="ruby-node">&quot;INSERT INTO #{source_list(@opts[:from])} () VALUES ()&quot;</span>
244:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000370" class="method-detail">
        <a name="M000370"></a>

        <div class="method-heading">
          <a href="#M000370" class="method-signature">
          <span class="method-name">insert_ignore</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets up multi_insert or import to use INSERT IGNORE. Useful if you have a
unique key and want to just skip inserting rows that violate the unique key
restriction.
</p>
<p>
Example:
</p>
<p>
dataset.insert_ignore.multi_insert(
</p>
<pre>
 [{:name =&gt; 'a', :value =&gt; 1}, {:name =&gt; 'b', :value =&gt; 2}]
</pre>
<p>
)
</p>
<p>
INSERT IGNORE INTO tablename (name, value) VALUES (a, 1), (b, 2)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000370-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000370-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 276</span>
276:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">insert_ignore</span>
277:         <span class="ruby-identifier">clone</span>(<span class="ruby-identifier">:insert_ignore=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword kw">true</span>)
278:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000368" class="method-detail">
        <a name="M000368"></a>

        <div class="method-heading">
          <a href="#M000368" class="method-signature">
          <span class="method-name">join_table</span><span class="method-args">(type, table, expr=nil, table_alias={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transforms an CROSS JOIN to an INNER JOIN if the expr is not nil. Raises an
error on use of :full_outer type, since <a href="../MySQL.html">MySQL</a>
doesn&#8216;t support it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000368-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000368-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 248</span>
248:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">join_table</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">table</span>, <span class="ruby-identifier">expr</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">table_alias</span>={})
249:         <span class="ruby-identifier">type</span> = <span class="ruby-identifier">:inner</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:cross</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">expr</span>.<span class="ruby-identifier">nil?</span>
250:         <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;MySQL doesn't support FULL OUTER JOIN&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:full_outer</span>
251:         <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">table</span>, <span class="ruby-identifier">expr</span>, <span class="ruby-identifier">table_alias</span>)
252:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000369" class="method-detail">
        <a name="M000369"></a>

        <div class="method-heading">
          <a href="#M000369" class="method-signature">
          <span class="method-name">join_type_sql</span><span class="method-args">(join_type)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transforms :natural_inner to NATURAL LEFT JOIN and straight to
STRAIGHT_JOIN.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000369-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000369-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 256</span>
256:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">join_type_sql</span>(<span class="ruby-identifier">join_type</span>)
257:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">join_type</span>
258:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:straight</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">'STRAIGHT_JOIN'</span>
259:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:natural_inner</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">'NATURAL LEFT JOIN'</span>
260:         <span class="ruby-keyword kw">else</span> <span class="ruby-keyword kw">super</span>
261:         <span class="ruby-keyword kw">end</span>
262:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000372" class="method-detail">
        <a name="M000372"></a>

        <div class="method-heading">
          <a href="#M000372" class="method-signature">
          <span class="method-name">multi_insert_sql</span><span class="method-args">(columns, values)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="../MySQL.html">MySQL</a> specific syntax for inserting multiple
values at once.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000372-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000372-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 309</span>
309:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">multi_insert_sql</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">values</span>)
310:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">update_cols</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:on_duplicate_key_update</span>]
311:           <span class="ruby-identifier">update_cols</span> = <span class="ruby-identifier">columns</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">update_cols</span>.<span class="ruby-identifier">empty?</span>
312:           <span class="ruby-identifier">update_string</span> = <span class="ruby-identifier">update_cols</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{quote_identifier(c)}=VALUES(#{quote_identifier(c)})&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-constant">COMMA_SEPARATOR</span>)
313:         <span class="ruby-keyword kw">end</span>
314:         <span class="ruby-identifier">values</span> = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">literal</span>(<span class="ruby-constant">Array</span>(<span class="ruby-identifier">r</span>))}.<span class="ruby-identifier">join</span>(<span class="ruby-constant">COMMA_SEPARATOR</span>)
315:         [<span class="ruby-node">&quot;INSERT#{' IGNORE' if opts[:insert_ignore]} INTO #{source_list(@opts[:from])} (#{identifier_list(columns)}) VALUES #{values}#{&quot; ON DUPLICATE KEY UPDATE #{update_string}&quot; if update_string}&quot;</span>]
316:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000371" class="method-detail">
        <a name="M000371"></a>

        <div class="method-heading">
          <a href="#M000371" class="method-signature">
          <span class="method-name">on_duplicate_key_update</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets up multi_insert or import to use ON DUPLICATE KEY UPDATE If you pass
no arguments, ALL fields will be updated with the new values. If you pass
the fields you want then ONLY those field will be updated.
</p>
<p>
Useful if you have a unique key and want to update inserting rows that
violate the unique key restriction.
</p>
<p>
Examples:
</p>
<p>
dataset.on_duplicate_key_update.multi_insert(
</p>
<pre>
 [{:name =&gt; 'a', :value =&gt; 1}, {:name =&gt; 'b', :value =&gt; 2}]
</pre>
<p>
)
</p>
<p>
INSERT INTO tablename (name, value) VALUES (a, 1), (b, 2) ON DUPLICATE KEY
UPDATE name=VALUES(name), value=VALUES(value)
</p>
<p>
dataset.on_duplicate_key_update(:value).multi_insert(
</p>
<pre>
 [{:name =&gt; 'a', :value =&gt; 1}, {:name =&gt; 'b', :value =&gt; 2}]
</pre>
<p>
)
</p>
<p>
INSERT INTO tablename (name, value) VALUES (a, 1), (b, 2) ON DUPLICATE KEY
UPDATE value=VALUES(value)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000371-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000371-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 304</span>
304:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">on_duplicate_key_update</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
305:         <span class="ruby-identifier">clone</span>(<span class="ruby-identifier">:on_duplicate_key_update</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">args</span>)
306:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000373" class="method-detail">
        <a name="M000373"></a>

        <div class="method-heading">
          <a href="#M000373" class="method-signature">
          <span class="method-name">quoted_identifier</span><span class="method-args">(c)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="../MySQL.html">MySQL</a> uses the nonstandard ` (backtick) for
quoting identifiers.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000373-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000373-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 319</span>
319:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quoted_identifier</span>(<span class="ruby-identifier">c</span>)
320:         <span class="ruby-node">&quot;`#{c}`&quot;</span>
321:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000374" class="method-detail">
        <a name="M000374"></a>

        <div class="method-heading">
          <a href="#M000374" class="method-signature">
          <span class="method-name">replace_sql</span><span class="method-args">(*values)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="../MySQL.html">MySQL</a> specific syntax for REPLACE (aka UPSERT,
or update if exists, insert if it doesn&#8216;t).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000374-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000374-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 325</span>
325:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">replace_sql</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">values</span>)
326:         <span class="ruby-identifier">from</span> = <span class="ruby-identifier">source_list</span>(<span class="ruby-ivar">@opts</span>[<span class="ruby-identifier">:from</span>])
327:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">empty?</span>
328:           <span class="ruby-node">&quot;REPLACE INTO #{from} DEFAULT VALUES&quot;</span>
329:         <span class="ruby-keyword kw">else</span>
330:           <span class="ruby-identifier">values</span> = <span class="ruby-identifier">values</span>[<span class="ruby-value">0</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
331:           
332:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">values</span>
333:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
334:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">empty?</span>
335:               <span class="ruby-node">&quot;REPLACE INTO #{from} DEFAULT VALUES&quot;</span>
336:             <span class="ruby-keyword kw">else</span>
337:               <span class="ruby-node">&quot;REPLACE INTO #{from} VALUES #{literal(values)}&quot;</span>
338:             <span class="ruby-keyword kw">end</span>
339:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>
340:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">empty?</span>
341:               <span class="ruby-node">&quot;REPLACE INTO #{from} DEFAULT VALUES&quot;</span>
342:             <span class="ruby-keyword kw">else</span>
343:               <span class="ruby-identifier">fl</span>, <span class="ruby-identifier">vl</span> = [], []
344:               <span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">fl</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">literal</span>(<span class="ruby-identifier">k</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">k</span>); <span class="ruby-identifier">vl</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">literal</span>(<span class="ruby-identifier">v</span>)}
345:               <span class="ruby-node">&quot;REPLACE INTO #{from} (#{fl.join(COMMA_SEPARATOR)}) VALUES (#{vl.join(COMMA_SEPARATOR)})&quot;</span>
346:             <span class="ruby-keyword kw">end</span>
347:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Dataset</span>
348:             <span class="ruby-node">&quot;REPLACE INTO #{from} #{literal(values)}&quot;</span>
349:           <span class="ruby-keyword kw">else</span>
350:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:values</span>)
351:               <span class="ruby-identifier">replace_sql</span>(<span class="ruby-identifier">values</span>.<span class="ruby-identifier">values</span>)
352:             <span class="ruby-keyword kw">else</span>  
353:               <span class="ruby-node">&quot;REPLACE INTO #{from} VALUES (#{literal(values)})&quot;</span>
354:             <span class="ruby-keyword kw">end</span>
355:           <span class="ruby-keyword kw">end</span>
356:         <span class="ruby-keyword kw">end</span>
357:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000375" class="method-detail">
        <a name="M000375"></a>

        <div class="method-heading">
          <a href="#M000375" class="method-signature">
          <span class="method-name">update_sql</span><span class="method-args">(values)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="../MySQL.html">MySQL</a> supports ORDER and LIMIT clauses in
UPDATE statements.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000375-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000375-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel/adapters/shared/mysql.rb, line 360</span>
360:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_sql</span>(<span class="ruby-identifier">values</span>)
361:         <span class="ruby-identifier">sql</span> = <span class="ruby-keyword kw">super</span>
362:         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; ORDER BY #{expression_list(opts[:order])}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:order</span>]
363:         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; LIMIT #{opts[:limit]}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:limit</span>]
364:         <span class="ruby-identifier">sql</span>
365:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>